<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediForge â€” Your Online Pharmacy</title>
    <meta name="description" content="Buy medicines online. 13,000+ medicines across 15 categories. Fast delivery.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="MediForge">
    <meta property="og:title" content="MediForge â€” Your Online Pharmacy">
    <meta property="og:description" content="Buy medicines online. 13,000+ medicines across 15 categories.">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="MediForge â€” Your Online Pharmacy">
    <link rel="canonical" href="/">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Plus Jakarta Sans',sans-serif; background:#f0fdf4; color:#1e293b; overflow-x:hidden; }
a { text-decoration:none; color:inherit; cursor:pointer; }
button, input { font-family:inherit; }
button { cursor:pointer; }
img { max-width:100%; height:auto; }

/* â”€â”€ Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
    --green:#16a34a; --green-d:#15803d; --green-l:#dcfce7; --green-xl:#f0fdf4;
    --teal:#0d9488;  --blue:#2563eb;
    --red:#dc2626;   --amber:#d97706;
    --slate-50:#f8fafc; --slate-100:#f1f5f9; --slate-200:#e2e8f0;
    --slate-400:#94a3b8; --slate-500:#64748b; --slate-700:#334155; --slate-900:#0f172a;
    --white:#fff;
    --radius:12px; --shadow:0 2px 16px rgba(0,0,0,0.07); --shadow-lg:0 8px 32px rgba(0,0,0,0.12);
    --nav-h:68px;
}

/* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.navbar { background:var(--white); border-bottom:1px solid var(--slate-200); position:sticky; top:0; z-index:200; box-shadow:0 1px 8px rgba(0,0,0,.04); }
.nav-inner { max-width:1280px; margin:0 auto; padding:0 1.5rem; height:var(--nav-h); display:flex; align-items:center; gap:1rem; }
.nav-brand { display:flex; align-items:center; gap:0.5rem; margin-right:auto; }
.nav-brand-icon { font-size:1.6rem; }
.nav-brand-name { font-weight:800; font-size:1.2rem; color:var(--slate-900); }
.nav-search { flex:1; max-width:380px; position:relative; }
.nav-search input { width:100%; padding:0.55rem 1rem 0.55rem 2.4rem; border:1.5px solid var(--slate-200); border-radius:10px; font-size:0.875rem; background:var(--slate-50); outline:none; transition:border-color .15s; }
.nav-search input:focus { border-color:var(--green); background:var(--white); }
.nav-search-icon { position:absolute; left:0.75rem; top:50%; transform:translateY(-50%); color:var(--slate-400); pointer-events:none; }
.nav-links { display:flex; align-items:center; gap:0.25rem; }
.nav-link { padding:0.45rem 0.875rem; border-radius:8px; color:var(--slate-500); font-weight:500; font-size:0.875rem; transition:all .15s; }
.nav-link:hover, .nav-link.active { background:var(--green-l); color:var(--green); font-weight:600; }
.nav-cart { position:relative; padding:0.5rem 0.875rem; border-radius:8px; font-size:1.2rem; transition:background .15s; }
.nav-cart:hover { background:var(--slate-100); }
.cart-badge { position:absolute; top:2px; right:2px; min-width:18px; height:18px; background:var(--green); color:#fff; border-radius:99px; font-size:0.65rem; font-weight:700; display:flex; align-items:center; justify-content:center; padding:0 4px; }

/* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loading-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:60vh; gap:1.25rem; color:var(--slate-400); }
.spinner { width:48px; height:48px; border:4px solid var(--slate-200); border-top-color:var(--green); border-radius:50%; animation:spin .7s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }

/* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero { background:linear-gradient(135deg,#dcfce7 0%,#d1fae5 50%,#a7f3d0 100%); padding:5rem 1.5rem; text-align:center; }
.hero-content { max-width:640px; margin:0 auto; }
.hero-badge { display:inline-flex; align-items:center; padding:0.4rem 1rem; background:var(--white); border-radius:99px; color:var(--green); font-weight:600; font-size:0.82rem; margin-bottom:1.5rem; box-shadow:0 2px 12px rgba(22,163,74,.15); }
.hero-title { font-size:clamp(2rem,5vw,3.25rem); font-weight:800; color:var(--slate-900); line-height:1.1; margin-bottom:1rem; }
.hero-sub { font-size:1.05rem; color:var(--slate-500); line-height:1.7; margin-bottom:2rem; }
.hero-cta { display:inline-flex; }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn { display:inline-flex; align-items:center; gap:0.4rem; padding:0.75rem 1.5rem; border:none; border-radius:10px; font-weight:700; font-size:0.9rem; cursor:pointer; transition:all .15s; }
.btn-primary { background:var(--green); color:#fff; }
.btn-primary:hover { background:var(--green-d); }
.btn-outline { background:var(--white); color:var(--slate-700); border:1.5px solid var(--slate-200); }
.btn-outline:hover { border-color:var(--green); color:var(--green); }
.btn-lg { padding:0.9rem 2rem; font-size:1rem; }

/* â”€â”€ Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { padding:3.5rem 1.5rem; max-width:1280px; margin:0 auto; }
.section-hd { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; }
.section-title { font-size:1.6rem; font-weight:700; color:var(--slate-900); }
.view-all { color:var(--green); font-weight:600; font-size:0.9rem; }
.view-all:hover { text-decoration:underline; }

/* â”€â”€ Category Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); gap:1rem; }
.cat-card { background:var(--white); border-radius:var(--radius); padding:1rem 0.75rem; text-align:center; cursor:pointer; transition:all .2s; border:2px solid transparent; box-shadow:var(--shadow); }
.cat-card:hover { border-color:var(--green); transform:translateY(-2px); }
.cat-card.active { border-color:var(--green); background:var(--green-l); }
.cat-img-wrap { width:64px; height:64px; margin:0 auto 0.75rem; border-radius:50%; background:var(--green-xl); display:flex; align-items:center; justify-content:center; overflow:hidden; }
.cat-img { width:48px; height:48px; object-fit:contain; }
.cat-name { font-size:0.78rem; font-weight:600; color:var(--slate-700); line-height:1.3; display:block; }

/* â”€â”€ Medicine Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.med-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1.25rem; }
.med-card { background:var(--white); border-radius:var(--radius); box-shadow:var(--shadow); display:flex; flex-direction:column; cursor:pointer; transition:transform .2s,box-shadow .2s; overflow:hidden; }
.med-card:hover { transform:translateY(-3px); box-shadow:var(--shadow-lg); }
.med-card-top { height:100px; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#f0fdf4,#dcfce7); position:relative; }
.med-emoji { font-size:3rem; }
.med-badges { position:absolute; top:0.5rem; right:0.5rem; display:flex; flex-direction:column; gap:0.25rem; }
.med-card-body { padding:1rem; flex:1; }
.med-cat-label { font-size:0.7rem; font-weight:600; text-transform:uppercase; letter-spacing:.06em; color:var(--green); margin-bottom:0.3rem; }
.med-name { font-size:0.9rem; font-weight:700; color:var(--slate-900); margin-bottom:0.35rem; line-height:1.35; }
.med-ingr { font-size:0.75rem; color:var(--slate-500); margin-bottom:0.25rem; }
.med-dosage-form { font-size:0.72rem; color:var(--slate-400); text-transform:capitalize; }
.med-card-footer { padding:0.75rem 1rem; border-top:1px solid var(--slate-100); display:flex; align-items:center; justify-content:space-between; }
.med-price { font-size:1.05rem; font-weight:800; color:var(--slate-900); }
.add-btn { padding:0.4rem 0.875rem; background:var(--green); color:#fff; border:none; border-radius:7px; font-size:0.8rem; font-weight:700; cursor:pointer; transition:background .15s; }
.add-btn:hover { background:var(--green-d); }

/* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge { padding:0.18rem 0.55rem; border-radius:6px; font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:.04em; }
.badge-rx { background:#fef2f2; color:var(--red); }
.badge-stock { background:var(--green-l); color:var(--green-d); }

/* â”€â”€ List page layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.list-layout { display:grid; grid-template-columns:240px 1fr; gap:2rem; max-width:1280px; margin:0 auto; padding:2rem 1.5rem; }
.cat-sidebar { position:sticky; top:calc(var(--nav-h) + 1rem); height:fit-content; }
.sidebar-title { font-size:0.9rem; font-weight:700; color:var(--slate-500); text-transform:uppercase; letter-spacing:.06em; margin-bottom:1rem; }
.sidebar-list { list-style:none; }
.sidebar-item { margin-bottom:0.25rem; }
.sidebar-item .cat-card { display:flex; align-items:center; gap:0.75rem; text-align:left; padding:0.6rem 0.875rem; border-radius:9px; background:transparent; box-shadow:none; border:none; width:100%; }
.sidebar-item .cat-img-wrap { width:36px; height:36px; flex-shrink:0; }
.sidebar-item .cat-img { width:24px; height:24px; }
.sidebar-item .cat-name { font-size:0.85rem; }
.sidebar-item.active .cat-card { background:var(--green-l); }
.list-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; flex-wrap:wrap; gap:0.75rem; }
.list-title { font-size:1.4rem; font-weight:700; color:var(--slate-900); }
.result-count { font-size:0.875rem; color:var(--slate-400); }
.load-more-wrap { text-align:center; margin-top:2.5rem; padding-bottom:3rem; }
.list-main { min-width:0; }

/* â”€â”€ Detail page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.detail-wrap { max-width:1100px; margin:0 auto; padding:2.5rem 1.5rem; }
.breadcrumb { display:flex; align-items:center; gap:0.4rem; font-size:0.875rem; color:var(--slate-400); margin-bottom:2.5rem; flex-wrap:wrap; }
.breadcrumb a { color:var(--green); cursor:pointer; }
.breadcrumb a:hover { text-decoration:underline; }
.detail-grid { display:grid; grid-template-columns:360px 1fr; gap:3rem; align-items:start; }
.detail-left { }
.detail-img { height:320px; background:linear-gradient(135deg,#f0fdf4,#dcfce7); border-radius:20px; display:flex; align-items:center; justify-content:center; font-size:8rem; margin-bottom:1.25rem; }
.detail-badges { display:flex; gap:0.5rem; flex-wrap:wrap; }
.detail-info { }
.detail-cat { font-size:0.78rem; font-weight:700; text-transform:uppercase; letter-spacing:.06em; color:var(--green); margin-bottom:0.5rem; }
.detail-name { font-size:1.75rem; font-weight:800; color:var(--slate-900); margin-bottom:0.5rem; line-height:1.2; }
.detail-ingr { font-size:0.95rem; color:var(--slate-500); margin-bottom:0.3rem; }
.detail-mfr { font-size:0.875rem; color:var(--slate-400); margin-bottom:1.25rem; }
.detail-price-row { display:flex; align-items:baseline; gap:1rem; margin-bottom:0.5rem; }
.detail-price { font-size:2rem; font-weight:800; color:var(--slate-900); }
.detail-pack { font-size:0.875rem; color:var(--slate-400); }
.detail-stock-line { font-size:0.85rem; color:var(--green-d); font-weight:600; margin-bottom:1rem; }
.detail-desc { color:var(--slate-500); line-height:1.8; margin-bottom:1.75rem; font-size:0.95rem; }
.qty-control { display:flex; align-items:center; width:fit-content; border:1.5px solid var(--slate-200); border-radius:10px; overflow:hidden; margin-bottom:1.25rem; }
.qty-btn { width:40px; height:44px; background:var(--slate-50); border:none; color:var(--slate-700); font-size:1.2rem; cursor:pointer; transition:background .1s; }
.qty-btn:hover { background:var(--slate-200); }
.qty-val { width:52px; text-align:center; font-weight:700; border:none; outline:none; border-left:1.5px solid var(--slate-200); border-right:1.5px solid var(--slate-200); height:44px; display:flex; align-items:center; justify-content:center; }
.detail-actions { display:flex; gap:0.75rem; flex-wrap:wrap; }

/* â”€â”€ Cart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cart-wrap { max-width:900px; margin:0 auto; }
.cart-empty { text-align:center; padding:5rem 2rem; color:var(--slate-400); }
.cart-empty .ei { font-size:4rem; margin-bottom:1rem; }
.cart-row { display:grid; grid-template-columns:60px 1fr auto auto auto; gap:1rem; align-items:center; padding:1rem 1.25rem; background:var(--white); border-radius:var(--radius); margin-bottom:0.75rem; box-shadow:var(--shadow); }
.order-summary { background:var(--white); border-radius:var(--radius); padding:1.5rem; box-shadow:var(--shadow); margin-top:1.5rem; }
.summary-row { display:flex; justify-content:space-between; padding:0.5rem 0; border-bottom:1px solid var(--slate-100); font-size:0.9rem; }
.summary-total { display:flex; justify-content:space-between; padding:0.875rem 0 0; font-size:1.1rem; font-weight:800; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container { position:fixed; bottom:1.5rem; right:1.5rem; z-index:999; display:flex; flex-direction:column; gap:0.5rem; }
.toast { background:var(--slate-900); color:#fff; padding:0.7rem 1.1rem; border-radius:10px; font-size:0.875rem; font-weight:500; box-shadow:var(--shadow-lg); display:flex; align-items:center; gap:0.5rem; animation:slideUp .22s ease; }
.toast.success { border-left:3px solid var(--green); }
.toast.error   { border-left:3px solid var(--red); }
@keyframes slideUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

/* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-footer { background:var(--slate-900); color:var(--slate-400); text-align:center; padding:2.5rem 1.5rem; margin-top:4rem; }
.footer-inner { font-size:0.85rem; }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:900px) {
    .list-layout { grid-template-columns:1fr; }
    .cat-sidebar { position:static; }
    .sidebar-list { display:flex; flex-wrap:wrap; gap:0.5rem; }
    .sidebar-item { flex-shrink:0; }
    .detail-grid { grid-template-columns:1fr; }
}
@media(max-width:640px) {
    .nav-search { display:none; }
    .cat-grid { grid-template-columns:repeat(3,1fr); }
}
    </style>
</head>
<body>

<div id="toast-container"></div>

<forge-app id="app"></forge-app>

<script type="module" src="dist/CategoryCard.forge.js"></script>
<script type="module" src="dist/MedicineCard.forge.js"></script>
<script type="module" src="dist/MedicineDetail.forge.js"></script>
<script type="module" src="dist/App.forge.js"></script>

<script type="module">
'use strict';

/* â”€â”€ API Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const API_BASE = '/api';
/* Token is injected server-side by dev-server.js proxy â€” no need to set here */
let AUTH_TOKEN = localStorage.getItem('mediforge_token') || '';

async function apiFetch(endpoint, opts = {}) {
    const headers = { 'Accept': 'application/json', ...opts.headers };
    if (AUTH_TOKEN) headers['Authorization'] = 'Bearer ' + AUTH_TOKEN;
    const res = await fetch(API_BASE + endpoint, { ...opts, headers });
    if (!res.ok) throw new Error(`API ${res.status}: ${endpoint}`);
    return res.json();
}

/* â”€â”€ Emoji map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getMedEmoji(dosage_form) {
    const map = {
        tablet:'ðŸ’Š', capsule:'ðŸ’Š', pill:'ðŸ’Š',
        syrup:'ðŸ§´', suspension:'ðŸ§´', liquid:'ðŸ§´', solution:'ðŸ§´',
        injection:'ðŸ’‰', vaccine:'ðŸ’‰',
        cream:'ðŸ§´', ointment:'ðŸ§´', gel:'ðŸ§´', lotion:'ðŸ§´',
        drops:'ðŸ’§', 'nasal spray':'ðŸ’§', 'eye drops':'ðŸ’§',
        inhaler:'ðŸ«', nebulizer:'ðŸ«',
        powder:'ðŸ«™', granules:'ðŸ«™',
        patch:'ðŸ©¹', bandage:'ðŸ©¹',
    };
    return map[(dosage_form || '').toLowerCase()] || 'ðŸ’Š';
}

/* â”€â”€ Flatten API medicine object â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function flattenMedicine(m) {
    return {
        ...m,
        price:            parseFloat(m.price) || 0,
        category_name:    m.category?.name || '',
        manufacturer_name: m.manufacturer?.name || '',
        emoji:            getMedEmoji(m.dosage_form),
    };
}

/* â”€â”€ Cart (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const Cart = {
    _key: 'mediforge_cart',
    get()           { try { return JSON.parse(localStorage.getItem(this._key)) || []; } catch { return []; } },
    save(items)     { localStorage.setItem(this._key, JSON.stringify(items)); },
    add(id, qty=1)  {
        const items = this.get();
        const ex = items.find(i => i.id === id);
        if (ex) ex.qty += qty; else items.push({ id, qty });
        this.save(items);
    },
    remove(id)      { this.save(this.get().filter(i => i.id !== id)); },
    setQty(id, qty) {
        if (qty <= 0) { this.remove(id); return; }
        const items = this.get();
        const it = items.find(i => i.id === id);
        if (it) it.qty = qty;
        this.save(items);
    },
    count()              { return this.get().reduce((s, i) => s + i.qty, 0); },
    subtotal(medicines)  { return this.get().reduce((s, i) => {
        const m = medicines.find(x => x.id === i.id);
        return m ? s + m.price * i.qty : s;
    }, 0); },
};

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toast(msg, type = '') {
    const el = Object.assign(document.createElement('div'), {
        className: 'toast' + (type ? ' ' + type : ''),
        textContent: msg,
    });
    document.getElementById('toast-container').appendChild(el);
    setTimeout(() => el.remove(), 3000);
}

/* â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const app        = document.getElementById('app');
let allMedicines = [];
let allCategories = [];
let currentPage  = 0;    /* API pagination offset page */
let currentCatId = 0;
let totalCount   = 0;
let searchQuery  = '';
let _isLoadingMore = false;

function updateBadge() {
    app.cart_count = Cart.count();
}

/* â”€â”€ Cart renderer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderCartPage() {
    const root = document.getElementById('cart-items-root');
    if (!root) return;
    const items = Cart.get().map(i => ({
        med: allMedicines.find(x => x.id === i.id),
        qty: i.qty,
    })).filter(i => i.med);

    if (!items.length) {
        root.innerHTML = `<div class="cart-empty">
            <div class="ei">ðŸ›’</div>
            <p>Your cart is empty.</p>
            <button class="btn btn-primary" id="cart-shop-btn">Browse Medicines</button>
        </div>`;
        document.getElementById('cart-shop-btn').onclick = () => { app.page = 1; };
        return;
    }

    const sub = Cart.subtotal(allMedicines);
    const tax = sub * 0.05;
    const total = sub + tax;
    const fmt = n => 'â‚¹' + Number(n).toFixed(2);

    root.innerHTML = `
        <div class="cart-wrap">
            ${items.map(({ med: m, qty }) => `
            <div class="cart-row" data-id="${m.id}">
                <div style="font-size:2rem;text-align:center">${m.emoji}</div>
                <div>
                    <div style="font-weight:600;font-size:.9rem">${m.name}</div>
                    <div style="font-size:.78rem;color:var(--slate-400)">${m.category_name}</div>
                    <div style="font-size:.82rem;font-weight:700;color:var(--green);margin-top:.2rem">${fmt(m.price)}</div>
                </div>
                <div style="display:flex;align-items:center;gap:.5rem">
                    <button class="qty-btn" data-action="dec" data-id="${m.id}" style="font-size:1rem">âˆ’</button>
                    <span style="min-width:1.5rem;text-align:center;font-weight:600">${qty}</span>
                    <button class="qty-btn" data-action="inc" data-id="${m.id}" style="font-size:1rem">+</button>
                </div>
                <div style="font-weight:700">${fmt(m.price * qty)}</div>
                <button class="qty-btn" data-action="remove" data-id="${m.id}" style="font-size:.8rem;color:var(--red)">âœ•</button>
            </div>`).join('')}
            <div class="order-summary">
                <div class="summary-row"><span>Subtotal</span><span>${fmt(sub)}</span></div>
                <div class="summary-row"><span>GST (5%)</span><span>${fmt(tax)}</span></div>
                <div class="summary-row"><span>Delivery</span><span style="color:var(--green)">FREE</span></div>
                <div class="summary-total"><span>Total</span><span>${fmt(total)}</span></div>
                <button class="btn btn-primary" style="width:100%;margin-top:1.25rem">Proceed to Checkout</button>
            </div>
        </div>`;

    root.addEventListener('click', e => {
        const id = +e.target.dataset.id;
        if (!id) return;
        const action = e.target.dataset.action;
        if (action === 'inc')    Cart.setQty(id, (Cart.get().find(i => i.id === id)?.qty || 0) + 1);
        else if (action === 'dec')    Cart.setQty(id, (Cart.get().find(i => i.id === id)?.qty || 1) - 1);
        else if (action === 'remove') Cart.remove(id);
        else return;
        updateBadge();
        renderCartPage();
    }, { once: true });
}

/* â”€â”€ API: Load categories â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadCategories() {
    try {
        const data = await apiFetch('/categories/');
        allCategories = (data.results || data).map(c => ({ ...c, active: 0 }));
        app.categories = allCategories;
    } catch (err) {
        console.warn('Categories load failed:', err.message);
    }
}

/* â”€â”€ API: Load medicines â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadMedicines(catId = 0, query = '', offset = 0) {
    let url = `/medicines/?is_discontinued=false&ordering=-created_at&limit=20`;
    if (catId)  url += `&category=${catId}`;
    if (query)  url += `&search=${encodeURIComponent(query)}`;
    if (offset) url += `&offset=${offset}`;

    const data = await apiFetch(url);
    return {
        results: (data.results || []).map(flattenMedicine),
        count:   data.count || 0,
    };
}

/* â”€â”€ API: Load medicine detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadMedicineDetail(id) {
    const m = await apiFetch(`/medicines/${id}/`);
    return flattenMedicine(m);
}

/* â”€â”€ Router â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const PAGE_PATHS = ['/', '/medicines', '/medicine', '/cart'];
const PATH_PAGE  = { '/': 0, '/home': 0, '/medicines': 1, '/cart': 3 };
let _routerBusy  = false;

function pushRoute(page, selectedId) {
    if (_routerBusy) return;
    let path;
    if (page === 2 && selectedId) path = '/medicine/' + selectedId;
    else path = PAGE_PATHS[page] || '/';
    if (window.location.pathname !== path) history.pushState(null, '', path);
}

function applyRoute(path) {
    path = path || '/';
    _routerBusy = true;
    const m = path.match(/^\/medicine\/(\d+)$/);
    if (m) {
        viewMedicine(+m[1]);
    } else {
        const page = PATH_PAGE[path];
        if (page !== undefined) {
            app._state.page = page;
            app._refresh();
        }
    }
    _routerBusy = false;
}

window.addEventListener('popstate', () => applyRoute(window.location.pathname));

document.addEventListener('click', e => {
    const a = e.target.closest('a[href]');
    if (!a) return;
    let url;
    try { url = new URL(a.href, location.origin); } catch { return; }
    if (url.origin !== location.origin) return;
    e.preventDefault();
    if (url.pathname === location.pathname) return;
    history.pushState(null, '', url.pathname);
    applyRoute(url.pathname);
});

/* â”€â”€ SEO updater â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SEO_CFG = {
    0: { title: 'MediForge â€” Your Online Pharmacy',    desc: 'Buy medicines online. 13,000+ medicines across 15 categories.' },
    1: { title: 'All Medicines â€” MediForge',           desc: 'Browse our full catalogue of prescription and OTC medicines.' },
    3: { title: 'Cart â€” MediForge',                    desc: 'Review your medicines and proceed to checkout.' },
};

function updateSEO(page, med) {
    let title, desc;
    if (page === 2 && med) {
        title = med.name + ' â€” MediForge';
        desc  = (med.description || med.name + ' ' + med.category_name).slice(0, 155);
    } else {
        const cfg = SEO_CFG[page] || SEO_CFG[0];
        title = cfg.title;
        desc  = cfg.desc;
    }
    document.title = title;
    const setMeta = (sel, attr, val) => {
        let el = document.querySelector(sel);
        if (!el) { el = document.createElement('meta'); document.head.appendChild(el); }
        el.setAttribute(attr, val);
    };
    setMeta('meta[name="description"]',        'content', desc);
    setMeta('meta[property="og:title"]',       'content', title);
    setMeta('meta[property="og:description"]', 'content', desc);
    setMeta('meta[name="twitter:title"]',      'content', title);
    const can = document.querySelector('link[rel="canonical"]');
    if (can) can.href = location.origin + location.pathname;
}

/* â”€â”€ View a medicine detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function viewMedicine(id) {
    app._state.page = 2;
    app._state.selected_id = id;
    app._refresh();

    try {
        /* Try from cache first, then fetch */
        let med = allMedicines.find(m => m.id === id);
        if (!med) med = await loadMedicineDetail(id);

        app._state.det_name       = med.name;
        app._state.det_price      = med.price;
        app._state.det_cat        = med.category_name || (med.category?.name || '');
        app._state.det_mfr        = med.manufacturer_name || (med.manufacturer?.name || '');
        app._state.det_ingredient = med.primary_ingredient || '';
        app._state.det_strength   = med.primary_strength   || '';
        app._state.det_form       = med.dosage_form         || '';
        app._state.det_pack       = med.pack_unit           || '';
        app._state.det_desc       = med.description         || '';
        app._state.det_emoji      = med.emoji || getMedEmoji(med.dosage_form);
        app._state.det_rx         = med.prescription_required ? 1 : 0;
        app._state.det_stock      = Array.isArray(med.stock) ? med.stock.length : (med.stock || 99);
        app._refresh();

        updateSEO(2, med);
        pushRoute(2, id);
    } catch (err) {
        toast('Could not load medicine details', 'error');
        console.error(err);
    }
}

/* â”€â”€ Load medicines list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function fetchMedicines(catId = currentCatId, query = searchQuery, reset = true) {
    if (reset) {
        currentPage = 0;
        allMedicines = [];
        app.loading = 1;
    }
    try {
        const { results, count } = await loadMedicines(catId, query, currentPage * 20);
        if (reset) {
            allMedicines = results;
        } else {
            allMedicines = [...allMedicines, ...results];
        }
        totalCount = count;
        app._state.total_count = count;
        app.products = allMedicines;
        app._state.loading = 0;
        app._refresh();
    } catch (err) {
        toast('Could not load medicines: ' + err.message, 'error');
        app._state.loading = 0;
        app._refresh();
    }
}

/* â”€â”€ Load more (pagination) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadMore() {
    if (_isLoadingMore || allMedicines.length >= totalCount) return;
    _isLoadingMore = true;
    const btn = document.getElementById('load-more-btn');
    if (btn) btn.textContent = 'Loadingâ€¦';
    currentPage++;
    await fetchMedicines(currentCatId, searchQuery, false);
    _isLoadingMore = false;
    if (btn) btn.textContent = allMedicines.length >= totalCount ? 'All loaded' : 'Load More';
}

/* â”€â”€ Bootstrap: wait for Forge custom element â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
customElements.whenDefined('forge-app').then(async () => {

    /* Patch _refresh for routing + SEO */
    let _lastPage = app._state.page;
    let _lastId   = app._state.selected_id;
    const origRefresh = app._refresh.bind(app);
    app._refresh = function() {
        origRefresh();
        const pg = this._state.page;
        const id = this._state.selected_id;
        if (pg !== _lastPage || (pg === 2 && id !== _lastId)) {
            if (pg === 3 && _lastPage !== 3) setTimeout(renderCartPage, 0);
            _lastPage = pg;
            _lastId   = id;
            if (pg !== 2) pushRoute(pg, id);  /* page 2 is pushed by viewMedicine */
        }
        if (pg !== 2) {
            const med = pg === 2 && id ? allMedicines.find(m => m.id === id) : null;
            updateSEO(pg, med);
        }
    };

    /* Load categories first, then featured medicines */
    await loadCategories();
    await fetchMedicines(0, '', true);
    app._state.loading = 0;
    app._refresh();

    /* Apply initial URL */
    updateSEO(0, null);
    if (window.location.pathname !== '/') applyRoute(window.location.pathname);

    /* Search handler */
    app.addEventListener('keydown', e => {
        if (e.target.id === 'med-search-input' && e.key === 'Enter') {
            searchQuery = e.target.value.trim();
            app._state.page = 1;
            fetchMedicines(currentCatId, searchQuery, true);
        }
    });

    /* Load-more button */
    app.addEventListener('click', e => {
        if (e.target.id === 'load-more-btn') loadMore();
    });

    updateBadge();
});

/* â”€â”€ CustomEvent handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.addEventListener('forge:select-category', async e => {
    const { id, name } = e.detail;

    /* Toggle: click same category again â†’ show all */
    const newId = (id === currentCatId) ? 0 : id;
    currentCatId = newId;

    /* Update active state on category cards */
    allCategories = allCategories.map(c => ({ ...c, active: c.id === newId ? 1 : 0 }));
    app.categories = allCategories;

    app._state.selected_cat = newId;
    app._state.selected_cat_name = newId ? name : 'All Medicines';
    app._state.page = 1;
    app._refresh();

    await fetchMedicines(newId, searchQuery, true);
});

window.addEventListener('forge:view-medicine', e => {
    viewMedicine(e.detail.id);
});

window.addEventListener('forge:add-to-cart', e => {
    const med = allMedicines.find(m => m.id === e.detail.id);
    if (!med) return;
    Cart.add(e.detail.id, e.detail.qty || 1);
    updateBadge();
    toast((med.name.length > 30 ? med.name.slice(0, 30) + 'â€¦' : med.name) + ' added to cart', 'success');
});

window.addEventListener('forge:go-back', () => {
    app._state.page = 1;
    app._refresh();
    pushRoute(1);
});
</script>
</body>
</html>
